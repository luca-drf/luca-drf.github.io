<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Luca Da Rin Fioretto | Oracle Instant Client and Python on M1</title><meta property="og:title" content="Luca Da Rin Fioretto | Oracle Instant Client and Python on M1"><meta property="og:image" content="https://lucadrf.dev/img/daro_profile.png"><meta name=description content><meta property="og:description" content><meta name=author content="Luca Da Rin Fioretto"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#176d86><meta name=msapplication-TileColor content="#2b5797"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css integrity=sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2 crossorigin=anonymous><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Hebrew&family=Open+Sans:wght@600&family=PT+Sans&family=Saira+Extra+Condensed:wght@500;600;700&display=swap" rel=stylesheet><link rel=preload href=https://use.fontawesome.com/releases/v6.1.1/css/all.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://use.fontawesome.com/releases/v6.1.1/css/all.css></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/devicons/devicon@v2.15.1/devicon.min.css><link rel=preload href=https://cdnjs.cloudflare.com/ajax/libs/simple-line-icons/2.5.5/css/simple-line-icons.min.css integrity="sha512-QKC1UZ/ZHNgFzVKSAhV5v5j73eeL9EEN289eKAEFaAjgAiobVAnVv/AGuPbXsKl1dNoel3kNr6PYnSiTzVVBCw==" crossorigin=anonymous as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/simple-line-icons/2.5.5/css/simple-line-icons.min.css integrity="sha512-QKC1UZ/ZHNgFzVKSAhV5v5j73eeL9EEN289eKAEFaAjgAiobVAnVv/AGuPbXsKl1dNoel3kNr6PYnSiTzVVBCw==" crossorigin=anonymous></noscript><link rel=stylesheet href=https://lucadrf.dev/css/resume.min.620ca4b022d0576157a0dac61effe466da1c9b440464b3c47ba2ee73a7355da2.css integrity="sha256-YgyksCLQV2FXoNrGHv/kZtocm0QEZLPEe6Luc6c1XaI=" media=screen><link rel=stylesheet href=https://lucadrf.dev/css/tweaks.min.73636ee73e6569221ff758c03dc142c87ad76d3d9725cc57f31c8ad073e75aae.css integrity="sha256-c2Nu5z5laSIf91jAPcFCyHrXbT2XJcxX8xyK0HPnWq4=" media=screen><link rel=stylesheet href=https://lucadrf.dev/css/resume-override.css></head><body id=page-top><nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top" id=sideNav><a class="navbar-brand js-scroll-trigger" href=#page-top><span class="d-block d-lg-none">Luca Da Rin Fioretto</span>
<span class="d-none d-lg-block"><img class="img-fluid img-profile rounded-circle mx-auto mb-2" src=/img/daro_profile.png alt></span></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class=navbar-nav><li class=nav-item><a class="nav-link js-scroll-trigger" href=/#about data-target=#about>About</a></li><li class=nav-item><a class="nav-link js-scroll-trigger" href=/#skills data-target=#skills>Skills</a></li><li class=nav-item><a class="nav-link js-scroll-trigger" href=/#experience data-target=#experience>Experience</a></li><li class=nav-item><a class="nav-link js-scroll-trigger" href=/#education data-target=#education>Education</a></li><li class=nav-item><a class="nav-link js-scroll-trigger" href=/#blog data-target=#blog>Blog</a></li></ul></div></nav><div class="container-fluid p-0"><nav aria-label=breadcrumb><ol class=breadcrumb><li class=breadcrumb-item><a href=https://lucadrf.dev/>Home</a></li><li class=breadcrumb-item><a href=https://lucadrf.dev/blog/>Blogs</a></li><li class="breadcrumb-item active"><a href=https://lucadrf.dev/blog/oracle-python-m1/>Oracle Instant Client and Python on M1</a></li></ol></nav><section class="resume-section p-3 p-lg-5 d-flex flex-column"><div class=my-auto><div class="mb-3 d-flex flex-row justify-content-between"><h2 class="portfolio mb-0"><span class=text-primary>Oracle Instant Client and Python on M1</span></h2><span>June 25, 2022</span></div><div><p>As a Web back-end developer, in general, I&rsquo;ve been quite happy working on an
Apple M1 platform. AArch64 is fairly well-supported and Rosetta2 fills most of
the gaps left open by the lack of available ARM64 builds.</p><p>An example of missing support for darwin/arm64 are Oracle Instant Client libs.
Luckily there are neat ways around it :)</p><h2 id=problem class=anchored-heading>Problem <a class="anchor js-scroll-trigger" href=#problem><i class="fa fa-link anchor-icons"></i></a></h2><p>Recently I wrote a Python program to extract some data from an &ldquo;old&rdquo; Oracle DB
11.2. Oracle provides a nice Python library to talk with Oracle DB which was
recently updated and renamed <a href=https://github.com/oracle/python-oracledb>oracledb</a>.
The only problem is that Oracle DB 11.2 is only supported in <em>Thick mode</em> which
requires <a href=https://www.oracle.com/database/technologies/instant-client.html>Oracle Instant Client</a>
libraries.</p><p>At the time of writing, Oracle doesn&rsquo;t distribute Oracle Instant Client arm64
builds for macOS and doesn&rsquo;t seem to be planning to. So I wondered how difficult
would have been to manage x86 libraries and executables alongside native arm64
ones in order to keep most of my development setup and workflows (i.e. avoiding
having to install VMs for developing with x86 libs and x86 Python builds).</p><p>After doing some research on the Interwebs, I found two or three solutions that
worked, but all of them involved some hackish setup. In the following guide I&rsquo;ll
show my approach in which I tried to be as neat and safe as possible.</p><p>(I&rsquo;m assuming XCode and Command Line Tools are already installed on your System)</p><p>Here we go:</p><h2 id=rosetta2 class=anchored-heading>Rosetta2 <a class="anchor js-scroll-trigger" href=#rosetta2><i class="fa fa-link anchor-icons"></i></a></h2><p>A good way to run darwin/x86_64 software on M1 is using <a href=https://support.apple.com/en-gb/HT211861>Rosetta2</a>
which is very well integrated in macOS and can be installed by simply:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/usr/sbin/softwareupdate --install-rosetta --agree-to-license
</span></span></code></pre></div><p>You might get a <code>Package Authoring Error</code> message, but that shouldn&rsquo;t prevent the
installation to terminate successfully.</p><h2 id=x86-terminal class=anchored-heading>x86 Terminal <a class="anchor js-scroll-trigger" href=#x86-terminal><i class="fa fa-link anchor-icons"></i></a></h2><p>The Terminal (in my case <a href=https://iterm2.com/>iTerm2</a>) is my main entry point in
running software when developing, so with Rosetta2 installed I first need an x86
emulated Terminal. That can be achieved by simply &ldquo;right-clicking&rdquo; on iTerm2 app
&ldquo;Duplicate&rdquo; it, rename the copied version &ldquo;iTerm-x86&rdquo;, then select it and
open the info panel (âŒ˜-I) and select &ldquo;Open Using Rosetta&rdquo; checkbox. Done. Note
that the same can be done with any other macOS app.</p><p>It&rsquo;s probably a good idea to update your command prompt to display some kind of
info about the architecture in order not to get confused when you have two
terminals looking exactly the same but running two different environments.</p><p>I&rsquo;ve added the following code to my zsh theme and included the variable in my
prompt.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>[</span> <span style=color:#000;font-weight:700>$(</span>arch<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#34;i386&#34;</span> <span style=color:#000;font-weight:700>]</span>; <span style=color:#000;font-weight:700>then</span>
</span></span><span style=display:flex><span>    <span style=color:teal>ARCH_PROMPT</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>&#34;x86&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>else</span>
</span></span><span style=display:flex><span>    <span style=color:teal>ARCH_PROMPT</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>&#34;arm&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>fi</span>
</span></span></code></pre></div><p>Note: you can always launch an x86 shell within your current shell:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>arch -x86_64 zsh
</span></span></code></pre></div><p>Also note: env will be inherited in the new zsh session. Personally I find it
safer to keep two separated terminals.</p><h2 id=x86-homebrew class=anchored-heading>x86 Homebrew <a class="anchor js-scroll-trigger" href=#x86-homebrew><i class="fa fa-link anchor-icons"></i></a></h2><p><a href=https://brew.sh/>Mac Homebrew</a> comes very handy for building and managing OSS
on macOS. Since Mac Homebrew on arm64 is rooted at <code>/opt/homebrew</code> instead of
<code>/usr/local</code>, it&rsquo;s possible to install x86 software and keep it neatly separated
from arm64. You just need to launch an x86 shell and simply install Mac Homebrew.</p><p>Then, in order to make sure your env is properly set, add the following code to
your <code>.zprofile</code> (or <code>.profile</code>)</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>[</span> <span style=color:#000;font-weight:700>$(</span>arch<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#34;i386&#34;</span> <span style=color:#000;font-weight:700>]</span>; <span style=color:#000;font-weight:700>then</span>
</span></span><span style=display:flex><span>  <span style=color:#0086b3>eval</span> <span style=color:#d14>&#34;</span><span style=color:#000;font-weight:700>$(</span>/usr/local/bin/brew shellenv<span style=color:#000;font-weight:700>)</span><span style=color:#d14>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#0086b3>alias</span> <span style=color:teal>brew</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>&#34;/usr/local/bin/brew&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>else</span>
</span></span><span style=display:flex><span>  <span style=color:#0086b3>eval</span> <span style=color:#d14>&#34;</span><span style=color:#000;font-weight:700>$(</span>/opt/homebrew/bin/brew shellenv<span style=color:#000;font-weight:700>)</span><span style=color:#d14>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#0086b3>alias</span> <span style=color:teal>brew</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>&#34;/opt/homebrew/bin/brew&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>fi</span>
</span></span></code></pre></div><h2 id=x86-python-with-pyenv class=anchored-heading>x86 Python with Pyenv <a class="anchor js-scroll-trigger" href=#x86-python-with-pyenv><i class="fa fa-link anchor-icons"></i></a></h2><p>Now that we have an x86 terminal and a dedicated space for our x86 libraries, we
need to build an x86 CPython interpreter. Luckily Pyenv will sort that out for us.</p><h3 id=pyenv class=anchored-heading>Pyenv <a class="anchor js-scroll-trigger" href=#pyenv><i class="fa fa-link anchor-icons"></i></a></h3><p>In order to build Python, we&rsquo;re going to use Pyenv (which you should be using
anyway for managing different Python versions and virtualenvs). Don&rsquo;t worry if
you already installed an &ldquo;arm&rdquo; Pyenv and populated Pyenv&rsquo;s root, the two executables
won&rsquo;t interfere with each other and can share the same root (e.g. <code>~/.pyenv</code>).</p><p>So using our x86 terminal, let&rsquo;s install Pyenv in the x86 space:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>brew install pyenv pyenv-virtualenv
</span></span></code></pre></div><p>Note: you might need to reload the shell in order for <code>pyenv-virtualenv</code> to work.
Also note: brew will take care of openssl and readline dependencies and install
their x86 versions in <code>/usr/local/opt</code>.</p><p>Let&rsquo;s also install <a href=https://github.com/s1341/pyenv-alias>Pyenv Alias</a> a handy
Pyenv plugin for naming Python versions, so we can keep arm and x86 Python builds
separated under <code>$(pyenv root)/versions</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone https://github.com/s1341/pyenv-alias.git <span style=color:#000;font-weight:700>$(</span>pyenv root<span style=color:#000;font-weight:700>)</span>/plugins/pyenv-alias
</span></span></code></pre></div><h3 id=python class=anchored-heading>Python <a class="anchor js-scroll-trigger" href=#python><i class="fa fa-link anchor-icons"></i></a></h3><p>Now we can build an x86 Python interpreter using our x86 terminal and Pyenv.
Also let&rsquo;s give it a custom name, so it won&rsquo;t interfere with other arm versions:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:teal>VERSION_ALIAS</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>&#34;3.10.3_x86&#34;</span> pyenv install 3.10.3
</span></span></code></pre></div><p>If everything worked fine you should be able to run a Python REPL and check the
interpreter platform using the <code>platform</code> module:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#000;font-weight:700>import</span> <span style=color:#555>platform</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>&gt;&gt;&gt;</span> platform<span style=color:#000;font-weight:700>.</span>machine()
</span></span><span style=display:flex><span><span style=color:#d14>&#39;x86_64&#39;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>&gt;&gt;&gt;</span>
</span></span></code></pre></div><p>Note that even when using an x86 terminal, an arm built Python interpreter would
print <code>'arm64'</code>.</p><h2 id=oracle-instant-client--python class=anchored-heading>Oracle Instant Client & Python <a class="anchor js-scroll-trigger" href=#oracle-instant-client--python><i class="fa fa-link anchor-icons"></i></a></h2><p>Finally, we have all we need to install Oracle Instant Client and start using it
with Python.</p><p>So, using our x86 terminal, let&rsquo;s install Oracle Instant Client libraries with
<code>brew</code>. We&rsquo;ll need to add a new tap first:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>brew tap InstantClientTap/instantclient
</span></span></code></pre></div><p>Then we can install the required libs (in my case I only need the basic-lite
version).</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>brew install instantclient-basiclite
</span></span></code></pre></div><p>At the time of writing, the above command should install Instant Client Basic Lite
version 19.8.0.0.0.</p><p>Let&rsquo;s now create a virtualenv for our project:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pyenv virtualenv 3.10.3_x86 my_project_x86
</span></span></code></pre></div><p>And activate it:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pyenv activate my_project_x86
</span></span></code></pre></div><p>Install the new <a href=https://github.com/oracle/python-oracledb>python-oracledb</a>
which has replaced the previous <code>cx_Oracle</code> (although the latter would work as well).</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pip install oracledb
</span></span></code></pre></div><p>Then let&rsquo;s test that Instant Client is correctly loaded. To do that, run a python
REPL and then:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#000;font-weight:700>import</span> <span style=color:#555>oracledb</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>&gt;&gt;&gt;</span> oracledb<span style=color:#000;font-weight:700>.</span>init_oracle_client()
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>&gt;&gt;&gt;</span> oracledb<span style=color:#000;font-weight:700>.</span>clientversion()
</span></span><span style=display:flex><span>(<span style=color:#099>19</span>, <span style=color:#099>8</span>, <span style=color:#099>0</span>, <span style=color:#099>0</span>, <span style=color:#099>0</span>)
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>&gt;&gt;&gt;</span>
</span></span></code></pre></div><p>Nice, now we can start developing our app!</p><h2 id=docker class=anchored-heading>Docker <a class="anchor js-scroll-trigger" href=#docker><i class="fa fa-link anchor-icons"></i></a></h2><p>As the app I was developing was going to be deployed as a Docker container, I
also wondered if there was an easy way to build an x86 Docker image on my M1 Mac
and perhaps spin up an x86 container as well, so I could &ldquo;smoke test it&rdquo; locally.</p><p>The answer is, well, in this case yes!</p><h3 id=python-toy-app class=anchored-heading>Python Toy App <a class="anchor js-scroll-trigger" href=#python-toy-app><i class="fa fa-link anchor-icons"></i></a></h3><p>For the purpose of this guide the app will simply init Oracle Client and then
print its version on stdout.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#998;font-style:italic># oracle_client_app.py</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>import</span> <span style=color:#555>oracledb</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>oracledb<span style=color:#000;font-weight:700>.</span>init_oracle_client()
</span></span><span style=display:flex><span>version <span style=color:#000;font-weight:700>=</span> oracledb<span style=color:#000;font-weight:700>.</span>clientversion()
</span></span><span style=display:flex><span><span style=color:#0086b3>print</span>(<span style=color:#d14>f</span><span style=color:#d14>&#34;Oracle Client version: </span><span style=color:#d14>{</span>version[<span style=color:#099>0</span>]<span style=color:#d14>}</span><span style=color:#d14>.</span><span style=color:#d14>{</span>version[<span style=color:#099>1</span>]<span style=color:#d14>}</span><span style=color:#d14>.</span><span style=color:#d14>{</span>version[<span style=color:#099>2</span>]<span style=color:#d14>}</span><span style=color:#d14>&#34;</span>)
</span></span></code></pre></div><h3 id=dockerfile class=anchored-heading>Dockerfile <a class="anchor js-scroll-trigger" href=#dockerfile><i class="fa fa-link anchor-icons"></i></a></h3><p>Now we need a Dockerfile that installs all our dependencies:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#000;font-weight:700>FROM</span><span style=color:#d14> python:3.10.3-slim-buster</span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2></span><span style=color:#998;font-style:italic># Install Oracle Instant Client</span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2></span><span style=color:#000;font-weight:700>WORKDIR</span><span style=color:#d14> /opt/oracle</span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2></span><span style=color:#000;font-weight:700>RUN</span> apt-get update <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>    <span style=color:#000;font-weight:700>&amp;&amp;</span> apt-get install -y libaio1 wget unzip <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>    <span style=color:#000;font-weight:700>&amp;&amp;</span> wget https://download.oracle.com/otn_software/linux/instantclient/1915000/instantclient-basiclite-linux.x64-19.15.0.0.0dbru-2.zip <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>    <span style=color:#000;font-weight:700>&amp;&amp;</span> unzip instantclient-basiclite-linux.x64-19.15.0.0.0dbru-2.zip <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>    <span style=color:#000;font-weight:700>&amp;&amp;</span> rm -f instantclient-basiclite-linux.x64-19.15.0.0.0dbru-2.zip <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>    <span style=color:#000;font-weight:700>&amp;&amp;</span> <span style=color:#0086b3>cd</span> /opt/oracle/instantclient_19_15 <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>    <span style=color:#000;font-weight:700>&amp;&amp;</span> rm -f *jdbc* *occi* *mysql* *README *jar uidrvci genezi adrci <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>    <span style=color:#000;font-weight:700>&amp;&amp;</span> <span style=color:#0086b3>echo</span> /opt/oracle/instantclient_19_15 &gt; /etc/ld.so.conf.d/oracle-instantclient.conf <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>    <span style=color:#000;font-weight:700>&amp;&amp;</span> ldconfig <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>    <span style=color:#000;font-weight:700>&amp;&amp;</span> apt-get purge -y --auto-remove wget unzip<span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2></span><span style=color:#000;font-weight:700>WORKDIR</span><span style=color:#d14> /app</span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2></span><span style=color:#000;font-weight:700>COPY</span> oracle_client_app.py /app<span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2></span><span style=color:#998;font-style:italic># Install GCC for compiling python-oracledb and then install it</span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2></span><span style=color:#000;font-weight:700>RUN</span> apt-get update <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>    <span style=color:#000;font-weight:700>&amp;&amp;</span> apt-get install -y gcc <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>    <span style=color:#000;font-weight:700>&amp;&amp;</span> apt-get clean <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>    <span style=color:#000;font-weight:700>&amp;&amp;</span> pip install --no-cache-dir oracledb <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>    <span style=color:#000;font-weight:700>&amp;&amp;</span> apt-get purge -y --auto-remove gcc<span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>
</span></span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2></span><span style=color:#000;font-weight:700>CMD</span> [<span style=color:#d14>&#34;python&#34;</span>, <span style=color:#d14>&#34;oracle_client_app.py&#34;</span>]<span style=color:#a61717;background-color:#e3d2d2>
</span></span></span></code></pre></div><p>Note: at the time of writing, the latest Oracle Client version for Linux64 is 21.6.0</p><h3 id=build-and-run class=anchored-heading>Build and Run <a class="anchor js-scroll-trigger" href=#build-and-run><i class="fa fa-link anchor-icons"></i></a></h3><p>We can build our x86 image by using Docker&rsquo;s <code>--platform</code> flag:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker build --platform linux/amd64 -t oracle_client_app
</span></span></code></pre></div><p>And then run it using the same flag:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run --platform linux/amd64 oracle_client_app:latest
</span></span></code></pre></div><p>Which, if everything went well, should print:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Oracle Client version: 19.15.0
</span></span></code></pre></div><p>Et voilÃ ! :)</p><h2 id=conclusion class=anchored-heading>Conclusion <a class="anchor js-scroll-trigger" href=#conclusion><i class="fa fa-link anchor-icons"></i></a></h2><p>This neat solution wouldn&rsquo;t have been possible without Mac Homebrew maintainers
separating x86 installations from arm ones, kudos to them.</p><p>Massive kudos to Apple for Rosetta2 and XCode working seamlessly in emulation mode.</p><p>And last but not least, it&rsquo;s really nice to see Docker Desktop for macOS
emulating x86 out of the box on arm.</p><p>Happy coding!</p></div></div></section><span style=color:#999;font-size:60%>Copyright &copy; 2022 Luca Da Rin Fioretto.</span>
<span style=color:#999;font-size:60%>Based on <a href=https://github.com/eddiewebb/hugo-resume>hugo-resume</a> theme and generated with <a href=https://gohugo.io/>HUGO</a></span></div><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js integrity=sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx crossorigin=anonymous></script>
<script async src=https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js integrity="sha512-0QbL0ph8Tc8g5bLhfVzSqxe9GERORsKhIn1IrpxDAgUsbBGz/V7iSav2zzW325XGd1OMLdL4UiqRJj702IeqnQ==" crossorigin=anonymous></script>
<script async src=https://lucadrf.dev/js/resume.min.js></script></body></html>